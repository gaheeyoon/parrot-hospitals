<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ê°€íˆì˜ ì•µë¬´ìƒˆ ë³‘ì› ğŸ¦œ</title>
    <meta name="description" content="ì „êµ­ì˜ ì•µë¬´ìƒˆ ì „ë¬¸ ì§„ë£Œ ë³‘ì›ì„ ì°¾ì•„ë³´ì„¸ìš”">
    <link href="style.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ¦œ ê°€íˆì˜ ì•µë¬´ìƒˆ ë³‘ì›</h1>
            <p>ì „êµ­ ì•µë¬´ìƒˆ ì§„ë£Œ ë³‘ì› ì•ˆë‚´</p>
        </header>

        <section class="search-section">
            <label for="searchInput">ë³‘ì› ê²€ìƒ‰</label>
            <input type="text" class="search-input" id="searchInput" placeholder="ë³‘ì› ì´ë¦„ ë˜ëŠ” ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" onkeyup="filterHospitals()">
        </section>

        <main id="hospitalList" class="hospital-list">
            <div class="empty-state">
                <div class="emoji">ğŸ¦œ</div>
                <p>ë³‘ì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
        </main>
    </div>
    
    <a class="fab-map" href="https://naver.me/GzE3FDpR" target="_blank">
        ğŸ—ºï¸ ì§€ë„ì—ì„œ ë³´ê¸°
    </a>

    <script>
        let hospitalsData = [];
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

        document.addEventListener("DOMContentLoaded", function() {
            fetch('hospitals.json')
                .then(response => response.json())
                .then(data => {
                    hospitalsData = data.hospitals;
                    renderHospitals(hospitalsData);
                })
                .catch(error => {
                    console.error('Error loading the hospital data:', error);
                    document.getElementById('hospitalList').innerHTML = `
                        <div class="empty-state">
                            <div class="emoji">ğŸ˜¢</div>
                            <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>ë¡œì»¬ ì„œë²„ë¡œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.</p>
                            <p style="margin-top: 15px; font-size: 0.9rem; color: #888;">
                                í„°ë¯¸ë„ì—ì„œ: <code style="background: #f0f0f0; padding: 4px 8px; border-radius: 4px;">npx serve</code>
                            </p>
                        </div>
                    `;
                });
        });

        function renderHospitals(hospitals) {
            const hospitalList = document.getElementById('hospitalList');
            hospitalList.innerHTML = '';

            if (hospitals.length === 0) {
                hospitalList.innerHTML = `
                    <div class="empty-state">
                        <div class="emoji">ğŸ”</div>
                        <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
                return;
            }

            // ì¦ê²¨ì°¾ê¸°ëœ ë³‘ì› ë¨¼ì € ì •ë ¬
            const sortedHospitals = [...hospitals].sort((a, b) => {
                return (favorites.includes(b.name) - favorites.includes(a.name));
            });

            sortedHospitals.forEach((hospital, index) => {
                const isFavorite = favorites.includes(hospital.name) ? 'active' : '';

                const divCard = document.createElement('div');
                divCard.className = 'card';
                divCard.style.animationDelay = `${index * 0.05}s`;
                
                const divCardBody = document.createElement('div');
                divCardBody.className = 'card-body';
                divCardBody.innerHTML = `
                    ${hospital.is24hour ? '<span class="badge">24ì‹œ ì§„ë£Œ</span>' : ''}
                    <h5 class="card-title">${hospital.name}</h5>
                    <p class="card-text">
                        ğŸ“ ${hospital.address}<br>
                        ğŸ“ ${hospital.phone}
                    </p>
                    <div class="btn-group">
                        <a href="tel:${hospital.phone}" class="btn btn-call">ğŸ“ ì „í™”í•˜ê¸°</a>
                        <a href="${hospital.map}" target="_blank" class="btn btn-map">ğŸ—ºï¸ ì§€ë„ë³´ê¸°</a>
                    </div>
                    <button class="favorite ${isFavorite}" onclick="toggleFavorite('${hospital.name}')" title="ì¦ê²¨ì°¾ê¸°">
                        ${isFavorite ? 'â˜…' : 'â˜†'}
                    </button>
                `;

                divCard.appendChild(divCardBody);
                hospitalList.appendChild(divCard);
            });
        }

        function toggleFavorite(hospitalName) {
            if (favorites.includes(hospitalName)) {
                favorites = favorites.filter(name => name !== hospitalName);
            } else {
                favorites.unshift(hospitalName);
            }
            localStorage.setItem('favorites', JSON.stringify(favorites));
            renderHospitals(hospitalsData);
        }

        function filterHospitals() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const filteredHospitals = hospitalsData.filter(hospital => 
                hospital.name.toLowerCase().includes(searchInput) || 
                hospital.address.toLowerCase().includes(searchInput) || 
                (hospital.address_sido && hospital.address_sido.toLowerCase().includes(searchInput)) || 
                (hospital.address_sgg && hospital.address_sgg.toLowerCase().includes(searchInput)) || 
                (hospital.address_umd && hospital.address_umd.toLowerCase().includes(searchInput))
            );
            renderHospitals(filteredHospitals);
        }
    </script>
</body>
</html>
